{% import "components/items.njk" as items %}

{% if nightfall.isAvailable %}

  {% extends "components/article.njk" %}

  {% set title = "Nightfall" %}
  {% set id = "nightfall" %}
  {% set description = "This week's Nightfall Strike locations, modifiers, and rewards." %}

  {% block content %}
    {% if nightfall.groupedActivities.length > 1 %}
      <p class="section-description">All Grandmaster Nightfalls are available!</p>
    {% endif %}
    <article class="vendor lost-sectors-container">
      <h3 class="section-subtitle">{{ nightfall.groupedActivities[0][0].displayProperties.description | safe}}</h3>
      <p class="vendor-subtitle">Nightfall</p>
      <img
        src="https://bungie.net{{ nightfall.groupedActivities[0][0].pgcrImage | safe}}"
        alt="Image of the Destiny 2 vendor {{vendor.name | safe}}."
        class="section-image">
      <p class="vendor-text">Nightfall found on <strong>{{ nightfall.groupedActivities[0][0].destination.displayProperties.name | safe }}</strong>.</p>
      <section class="lost-sector-modifiers-group">
        <h4 class="lost-sector-modifier-heading">Rewards</h4>
        <ul role="list" class=" lost-sector-list lost-sector-rewards-list">
          {% for item in nightfall.rewards %}
            <li class="">
              {{ items.inventoryItem(item.displayProperties.name, item.displayProperties.description, icon=item.displayProperties.icon) }}
            </li>
          {% endfor %}
        </ul>
      </section>
      <section class="lost-sector-modifiers-container">
        {% for name, modifiers in nightfall.modifierGroups | groupby("name") %}
          {% if loop.index0 % 2 === 0 %}
            <section class="lost-sector-modifiers-group">
            {% endif %}
            <h4 class="lost-sector-modifier-heading">{{name}}</h4>
            <ul role="list" class=" lost-sector-list">
              {% for item in modifiers %}
                <li class="">
                  {{ items.inventoryItem(item.displayProperties.name, item.displayProperties.description, icon=item.displayProperties.icon) }}
                </li>
              {% endfor %}
            </ul>
            {% if loop.index0 % 2 !== 0 %}
            </section>
          {% endif %}
        {% endfor %}
      </section>
    </article>
  {% endblock %}
{% endif %}